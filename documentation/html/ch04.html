<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 4. System Services</title><link rel="stylesheet" type="text/css" href="docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="Pines Development" /><link rel="up" href="pt01.html" title="Part I. The Pines Framework" /><link rel="prev" href="ch03s06.html" title="3.6. Order of Execution" /><link rel="next" href="ch04s02.html" title="4.2. Creating a Service" /></head><body><a xmlns:fo="http://www.w3.org/1999/XSL/Format" href="index.html"><div class="header">Pines Development</div></a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. System Services</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s06.html">Prev</a> </td><th width="60%" align="center">Part I. The Pines Framework</th><td width="20%" align="right"> <a accesskey="n" href="ch04s02.html">Next</a></td></tr></table><hr /></div><div class="chapter" title="Chapter 4. System Services"><div class="titlepage"><div><div><h2 class="title"><a id="idp721520"></a>Chapter 4. System Services</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="ch04.html#idp722896">4.1. System Services</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#idp723776">4.1.1. Configurator</a></span></dt><dt><span class="section"><a href="ch04.html#idp760720">4.1.2. Editor</a></span></dt><dt><span class="section"><a href="ch04.html#idp767088">4.1.3. Entity Manager</a></span></dt><dt><span class="section"><a href="ch04.html#idp967440">4.1.4. Icons</a></span></dt><dt><span class="section"><a href="ch04.html#idp973168">4.1.5. Log Manager</a></span></dt><dt><span class="section"><a href="ch04.html#template_service">4.1.6. Template</a></span></dt><dt><span class="section"><a href="ch04.html#idp1011776">4.1.7. Uploader</a></span></dt><dt><span class="section"><a href="ch04.html#idp1026368">4.1.8. User Manager</a></span></dt></dl></dd><dt><span class="section"><a href="ch04s02.html">4.2. Creating a Service</a></span></dt></dl></div>
      

      <p>System services provide many features, and allow these features to
      be implemented in many different ways. System services are not provided
      by Pines Core. They are, however, well defined and must conform to
      certain guidelines to ensure that any component designed to use them
      will work with any implementation.</p>

      <div class="section" title="4.1. System Services"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp722896"></a>4.1. System Services</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch04.html#idp723776">4.1.1. Configurator</a></span></dt><dt><span class="section"><a href="ch04.html#idp760720">4.1.2. Editor</a></span></dt><dt><span class="section"><a href="ch04.html#idp767088">4.1.3. Entity Manager</a></span></dt><dt><span class="section"><a href="ch04.html#idp967440">4.1.4. Icons</a></span></dt><dt><span class="section"><a href="ch04.html#idp973168">4.1.5. Log Manager</a></span></dt><dt><span class="section"><a href="ch04.html#template_service">4.1.6. Template</a></span></dt><dt><span class="section"><a href="ch04.html#idp1011776">4.1.7. Uploader</a></span></dt><dt><span class="section"><a href="ch04.html#idp1026368">4.1.8. User Manager</a></span></dt></dl></div>
        

        <div class="section" title="4.1.1. Configurator"><div class="titlepage"><div><div><h3 class="title"><a id="idp723776"></a>4.1.1. Configurator</h3></div></div></div>
          

          <p>The configurator service allows the user and other components
          to edit/save configuration and enable/disable components. In Pines,
          a component is disabled by prepending a period (.) to its
          directory's name. This is the same way the directory is hidden on
          Linux file systems.</p>

          <p>The configurator itself has the following
          methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="methodname">disable_component</code></p>

                <p>Disables a component. This is accomplished by prepending
                a dot to its directory's name. Accepts the name of the
                component as the only argument.</p>
              </li><li class="listitem">
                <p><code class="methodname">enable_component</code></p>

                <p>Enables a component. This is accomplished by removing
                the dot from the beginning of its directory's name. Accepts
                the name of the component as the only argument.</p>
              </li><li class="listitem">
                <p><code class="methodname">list_components</code></p>

                <p>Creates and attaches a module which lists configurable
                components. It also returns the created module.</p>
              </li></ul></div><div class="informalexample">
              <h4><a id="idp731376"></a>Enabling and Disabling Components</h4>

              <pre class="programlisting">// Enable the component com_good.
$pines-&gt;configurator-&gt;enable_component('com_good');

// Disable the component com_bad.
$pines-&gt;configurator-&gt;disable_component('com_bad');</pre>
            </div>

          <div class="section" title="4.1.1.1. Configurator Component"><div class="titlepage"><div><div><h4 class="title"><a id="idp732976"></a>4.1.1.1. Configurator Component</h4></div></div></div>
            

            <p>The configurator also provides a class for retrieving and
            manipulating a component's configuration. This class is the
            <code class="classname">configurator_component</code> class. It provides
            the static method <code class="methodname">factory</code>, which accepts
            the component's name as the only argument and returns a new
            instance of <code class="classname">configurator_component</code> for the
            provided component. The class constructor also accepts this
            argument, but using the <code class="methodname">factory</code> method is
            recommended.</p>

            <p>The component configurator class has these
            properties:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><span class="property">defaults</span></p>

                  <p>The configuration defaults.</p>
                </li><li class="listitem">
                  <p><span class="property">config</span></p>

                  <p>The current configuration.</p>
                </li><li class="listitem">
                  <p><span class="property">config_keys</span></p>

                  <p>The current configuration in an array with key =&gt;
                  values.</p>
                </li><li class="listitem">
                  <p><span class="property">info</span></p>

                  <p>The info object of the component.</p>
                </li><li class="listitem">
                  <p><span class="property">name</span></p>

                  <p>The component.</p>
                </li></ul></div><p>The component configurator class provides these
            methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">get_full_config_array</code></p>

                  <p>Get a full config array. (With defaults
                  replaced.)</p>
                </li><li class="listitem">
                  <p><code class="methodname">is_configurable</code></p>

                  <p>Check if a component is configurable.</p>
                </li><li class="listitem">
                  <p><code class="methodname">is_disabled</code></p>

                  <p>Check if a component is disabled.</p>
                </li><li class="listitem">
                  <p><code class="methodname">print_form</code></p>

                  <p>Print a form to edit the configuration.</p>
                </li><li class="listitem">
                  <p><code class="methodname">print_view</code></p>

                  <p>Print a view of the configuration.</p>
                </li><li class="listitem">
                  <p><code class="methodname">save_config</code></p>

                  <p>Write the configuration to the config file.</p>
                </li><li class="listitem">
                  <p><code class="methodname">set_config</code></p>

                  <p>Set the current config by providing an array of key
                  =&gt; values. Any value not provided will be set back to
                  default.</p>
                </li></ul></div><div class="informalexample">
                <h5><a id="idp755104"></a>Changing a Component's Configuration</h5>

                <pre class="programlisting">// Load the component's configuration.
$conf = configurator_component::factory('com_example');
// Set the new configuration.
$conf-&gt;set_config(array(
    'host' =&gt; $host,
    'user' =&gt; $user,
    'password' =&gt; $password,
    'database' =&gt; $database
));
// Save the new configuration to disk.
if (!$conf-&gt;save_config())
    pines_error('Couldn\'t save config.');</pre>
              </div>

            <p>When the configuration is saved, the configurator creates a
            <code class="filename">config.php</code> file in the component's directory
            (if it does not already exist), and saves a script to the file,
            which returns the configuration values as an array of associative
            arrays. Each associative array contains an entry called "name" and
            an entry called "value". The config service uses this file when
            building the component's configuration, replacing values from
            <code class="filename">defaults.php</code> with the values from this
            file.</p><div class="informalexample">
                <h5><a id="idp758528"></a>Example config.php File</h5>

                <pre class="programlisting">&lt;?php
defined('P_RUN') or die('Direct access prohibited');
return array (
  0 =&gt; 
  array (
    'name' =&gt; 'notice_text',
    'value' =&gt; 'Notice: you have exceeded the limits.',
  ),
  1 =&gt;
  array (
    'name' =&gt; 'limits',
    'value' =&gt; 
    array (
      0 =&gt; 9.33,
      1 =&gt; 13.6,
    ),
  ),
);
?&gt;</pre>
              </div>
          </div>
        </div>

        <div class="section" title="4.1.2. Editor"><div class="titlepage"><div><div><h3 class="title"><a id="idp760720"></a>4.1.2. Editor</h3></div></div></div>
          

          <p>The editor service provides a more friendly HTML editor for
          the user. When editing some sort of content, which is to be
          displayed in a page or email, a textarea is usually not the best
          solution. The editor service provides a method which allows the
          system administrator to choose between multiple HTML editors to
          provide for the system's users.</p>

          <p>Once the editor is loaded, it will transform any textareas
          with the class "peditor", "peditor-simple", or "peditor-email" into
          HTML editors. If it provides a simplified editor, textareas with the
          class "peditor-simple" will use this editor instead. If it provides
          an email editor, textareas with the class "peditor-email" will use
          this editor instead. Email editors will format content for emails.
          This includes full URLs for links and images, no stylesheets,
          etc.</p>

          <p>The editor has a method, <code class="methodname">load</code>, which
          loads the editor. This method should be called from a view, to
          ensure it is only called when outputting HTML. The editor also has a
          method, <code class="methodname">add_css</code>, which takes one argument,
          the URL of a stylesheet to use for styling WYSIWYG
          content.</p><div class="informalexample">
              <h4><a id="idp764928"></a>Using the Editor Service in a View</h4>

              <pre class="programlisting">&lt;?php
/**
 * Prints editors.
 *
 * @license http://www.gnu.org/licenses/agpl-3.0.html
 * @author Hunter Perrin &lt;hperrin@gmail.com&gt;
 * @copyright SciActive.com
 * @link http://sciactive.com/
 */
/* @var $pines pines *//* @var $this module */
defined('P_RUN') or die('Direct access prohibited');
$this-&gt;title = 'Editors';
// Load the editor.
$pines-&gt;editor-&gt;load();
// Load a custom stylesheet.
$pines-&gt;editor-&gt;add_css($pines-&gt;config-&gt;location.'components/com_example/includes/custom.css');
?&gt;
&lt;div&gt;Regular Editor&lt;/div&gt;
&lt;div&gt;&lt;textarea rows="3" cols="35" class="peditor"&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;br /&gt;
&lt;div&gt;Simple Editor&lt;/div&gt;
&lt;div&gt;&lt;textarea rows="3" cols="35" class="peditor-simple"&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;br /&gt;
&lt;div&gt;Email Editor&lt;/div&gt;
&lt;div&gt;&lt;textarea rows="3" cols="35" class="peditor-email"&gt;&lt;/textarea&gt;&lt;/div&gt;</pre>
            </div>
        </div>

        <div class="section" title="4.1.3. Entity Manager"><div class="titlepage"><div><div><h3 class="title"><a id="idp767088"></a>4.1.3. Entity Manager</h3></div></div></div>
          

          <p>Go brew some coffee or drink an energy drink, cause this is
          without a doubt, the most complex and important part of Pines!
          Understanding the entity manager lets you build complex
          relationships between data as easily as setting the value of a
          property.</p>

          <div class="section" title="4.1.3.1. Introduction"><div class="titlepage"><div><div><h4 class="title"><a id="idp768752"></a>4.1.3.1. Introduction</h4></div></div></div>
            

            <p>The entity manager service provides database abstraction for
            Pines. Data in Pines is based on objects called entities. An
            entity is an object which can hold any type of data available in
            PHP (except resources), including other entities. All entity
            classes (and therefore all entities) inherit the
            <code class="classname">entity</code> class.</p>

            <p>Components can freely access the database if they wish,
            however it is strongly discouraged, as this prevents portability
            and extensibility. Using entities to store data has several
            benefits for both developers and site operators.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p>Site operators can choose which database backend to
                  use, based on their own needs.</p>
                </li><li class="listitem">
                  <p>Moving from one database to another, backing up and
                  restoring a database, and mirroring databases are much
                  easier through an entity manager.</p>
                </li><li class="listitem">
                  <p>Data storage is much easier and faster to code.</p>
                </li><li class="listitem">
                  <p>Data querying is much easier and faster to
                  code.</p>
                </li><li class="listitem">
                  <p>A component can store data in another component's
                  entities and extend its functionality.</p>
                </li><li class="listitem">
                  <p>The user manager provides access control for all
                  entities automatically.</p>
                </li></ul></div>

            <p>Entities are not strictly structured, so data of any type
            can be added and saved just by assigning a variable on the entity
            and calling <code class="methodname">save</code>. This makes data
            manipulation in Pines very easy.</p>

            <p>All entities are given a globally unique identifier (GUID),
            which is an integer (but may not be in the future). No entities in
            the same Pines installation will ever have the same GUID. The
            entity manager also provides UIDs, which can be used to number
            certain types of entities (or practically anything else). UIDs can
            be used to provide a more visibly pleasing identifier for
            entities.</p>

            <p>Entities are organized with tags. For example, if a
            component, com_blog, wanted to store posts using an entity, it may
            add the tags "com_blog" and "post" to all new instances. This
            allows components to select and differentiate their entities from
            other components' entities.</p>

            <p>An entity's class is usually named by appending to their
            component's name. In the previous example, the class would
            probably be called <code class="classname">com_blog_post</code>. When
            selecting entities with the entity manager, the class used to
            retrieve them must be specified, or the
            <code class="classname">entity</code> class will be used. If an entity is
            referenced in another entity's variable, the class is saved along
            with the GUID. When this variable is accessed later, the entity
            manager will retrieve the referenced entity using the saved
            class.</p><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="caution.png" /></td><th align="left">Caution</th></tr><tr><td align="left" valign="top">
                <p>When changing an entity's class name, any entities
                referencing it must be resaved after setting the reference
                again using the new class name.</p>
              </td></tr></table></div>
          </div>

          <div class="section" title="4.1.3.2. Creating Entities"><div class="titlepage"><div><div><h4 class="title"><a id="idp783344"></a>4.1.3.2. Creating Entities</h4></div></div></div>
            

            <p>To create an entity, call the
            <code class="methodname">factory</code> static method of an entity's
            class. The <code class="classname">entity</code> class takes a list of
            tags as arguments. However, if an author chooses, the
            <code class="methodname">factory</code> method of an inheriting class can
            take any other arguments. It will usually take only one argument,
            a GUID. It would return the entity with the GUID or, if it didn't
            exist or no GUID was provided, a new entity. The
            <code class="methodname">factory</code> method is used instead of the
            <span class="keysym">new</span> keyword to provide entities a chance to set
            up hooking on their objects. To check that an entity is a new
            entity (it hasn't been saved), check that the GUID has not been
            set.</p><div class="informalexample">
                <h5><a id="idp787728"></a>Creating an Entity</h5>

                <pre class="programlisting">// Using the entity class.
$new_entity = entity::factory();

// Using a custom class.
$blog_post = com_blog_post::factory();

// Check that the entity is new.
if (isset($new_entity-&gt;guid))
    pines_notice('This entity is not a new entity!');</pre>
              </div>

            <p>Much like blogs in many blogging systems, entities are
            organized using tags. Entity tags are not supposed to be added by
            the user, as this could allow them to create or manipulate users,
            groups, configurations, etc. It may seem inviting to use the
            entity tags to store user provided data, but don't! Though not
            strictly necessary, it is <span class="bold"><strong>highly
            recommended</strong></span> to give every entity your component creates
            a tag identical to your component's name, such as 'com_xmlparser'.
            You don't want to accidentally get another component's
            entities.</p>

            <p>Be very cautious when saving an entity in another entity's
            variable. If the referenced entity is newly created and does not
            have a GUID, the entity manager will not be able to retrieve it
            later. Always save the referenced entity first.</p><div class="informalexample">
                <h5><a id="idp791600"></a>Saving a Referenced Entity the Wrong
                Way</h5>

                <pre class="programlisting">$entity = entity::factory();
$entity-&gt;foo = entity::factory();

$entity-&gt;save(); // foo hasn't been saved yet!
$entity-&gt;foo-&gt;bar = 'It works!';
$entity-&gt;foo-&gt;save();

$guid = $entity-&gt;guid;
unset($entity);
$entity = $pines-&gt;entity_manager-&gt;get_entity($guid);

isset($entity-&gt;foo-&gt;guid); // False
echo $entity-&gt;foo-&gt;bar; // Outputs nothing.</pre>
              </div><div class="informalexample">
                <h5><a id="idp793776"></a>Saving a Referenced Entity the Right
                Way</h5>

                <pre class="programlisting">$entity = entity::factory();
$entity-&gt;foo = entity::factory();

$entity-&gt;foo-&gt;bar = 'It works!';
$entity-&gt;foo-&gt;save(); // Saving the referenced entity first! :)
$entity-&gt;save(); // now foo has been saved.

$guid = $entity-&gt;guid;
unset($entity);
$entity = $pines-&gt;entity_manager-&gt;get_entity($guid);

isset($entity-&gt;foo-&gt;guid); // True
echo $entity-&gt;foo-&gt;bar; // Outputs 'It works!'.</pre>
              </div>

            <div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="caution.png" /></td><th align="left">Caution</th></tr><tr><td align="left" valign="top">
              <p>Since the reference entity's class name is stored in the
              reference on the entity's first save and used to retrieve the
              reference entity using the same class, if you change the class
              name in an update, you need to reassign the reference entity and
              save to storage.</p>
            </td></tr></table></div>

            <p>When an entity is loaded, it does not request its referenced
            entities from the entity manager. This is done the first time the
            variable/array is accessed. The referenced entity is then stored
            in a cache, so if it is altered elsewhere, then accessed again
            through the variable, the changes will <span class="bold"><strong>not</strong></span> be there. Therefore, you should take
            great care when accessing entities from multiple variables. If you
            might be using a referenced entity again later in the code
            execution (after some other processing occurs), it's recommended
            to call <code class="methodname">clear_cache</code>.</p>
          </div>

          <div class="section" title="4.1.3.3. Entities"><div class="titlepage"><div><div><h4 class="title"><a id="idp798800"></a>4.1.3.3. Entities</h4></div></div></div>
            

            <p>As mentioned before, entities are organized using tags. To
            add, remove, and check tags, the methods
            <code class="methodname">add_tag</code>,
            <code class="methodname">remove_tag</code>, and
            <code class="methodname">has_tag</code> are used, respectively. Each
            takes any number of tags or an array of tags as
            arguments.</p><div class="informalexample">
                <h5><a id="idp801840"></a>Manipulating Entity Tags</h5>

                <pre class="programlisting">$entity = entity::factory();

$entity-&gt;add_tag('com_foobar', 'foo', 'bar');
$entity-&gt;has_tag('foo'); // True

$entity-&gt;remove_tag('foo', 'bar');
$entity-&gt;has_tag('foo'); // False</pre>
              </div>

            <p>To clear the cache of referenced entities, so that the next
            time one is accessed it will be pulled from the database, use the
            <code class="methodname">clear_cache</code> method.</p><div class="informalexample">
                <h5><a id="idp804496"></a>Clearing the Reference Entity Cache</h5>

                <pre class="programlisting">$entity = entity::factory();
$entity-&gt;foo = entity::factory();
$entity-&gt;foo-&gt;bar = 'Old value.';
$entity-&gt;foo-&gt;save();
$entity-&gt;save();

$entity = $pines-&gt;entity_manager-&gt;get_entity($entity-&gt;guid);

$inst_of_foo = $pines-&gt;entity_manager-&gt;get_entity($entity-&gt;foo-&gt;guid);
$inst_of_foo-&gt;bar = 'New value.';
$inst_of_foo-&gt;save();

echo $entity-&gt;foo-&gt;bar; // Outputs 'Old value.'
$entity-&gt;clear_cache();
echo $entity-&gt;foo-&gt;bar; // Outputs 'New value.'</pre>
              </div>

            <p>Much like clearing the entity cache, you may need to refresh
            the entity's own data. Use the <code class="methodname">refresh</code>
            method for this.</p><div class="informalexample">
                <h5><a id="idp807392"></a>Refreshing an Entity's Data</h5>

                <pre class="programlisting">$entity = entity::factory();
$entity-&gt;foo = 'Old value.';
$entity-&gt;save();

$inst_of_ent = $pines-&gt;entity_manager-&gt;get_entity($entity-&gt;guid);
$inst_of_ent-&gt;foo = 'New value.';
$inst_of_ent-&gt;save();

echo $entity-&gt;foo; // Outputs 'Old value.'
$entity-&gt;refresh();
echo $entity-&gt;foo; // Outputs 'New value.'</pre>
              </div>

            <p>As you've already seen in the examples, to save an entity,
            use the <code class="methodname">save</code> method. Likewise, to delete
            the entity, use the <code class="methodname">delete</code> method. You
            can also call the <code class="methodname">save_entity</code>,
            <code class="methodname">delete_entity</code>, and
            <code class="methodname">delete_entity_by_id</code> methods of the entity
            manager itself. Entities use these methods, which allows hooking
            of all entity saves and deletes.</p><div class="informalexample">
                <h5><a id="idp812336"></a>Different Ways of Saving and Deleting
                Entities</h5>

                <pre class="programlisting">$entity = entity::factory();

// Save the entity.
$entity-&gt;save();
// or
$pines-&gt;entity_manager-&gt;save_entity($entity);

// Delete the entity.
$entity-&gt;delete();
// or
$pines-&gt;entity_manager-&gt;delete_entity($entity);
// or
$pines-&gt;entity_manager-&gt;delete_entity_by_id($entity-&gt;guid);</pre>
              </div>

            <p>Several methods are provided by entities to find and compare
            them with other data. Entities cannot simply be checked using the
            == operator. It will almost always fail because of things like
            entity caching and sleeping references. Instead, you can use the
            following entity methods.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">is</code></p>

                  <p>Perform a less strict comparison of two entities. To
                  return true, the entity and the object passed must meet the
                  following criteria:</p><table border="0" summary="Simple list" class="simplelist"><tr><td>They must be entities.</td></tr><tr><td>They must have equal GUIDs. (Or both can have no
                      GUID.)</td></tr><tr><td>If they have no GUIDs, their data must be
                      equal.</td></tr></table>
                </li><li class="listitem">
                  <p><code class="methodname">equals</code></p>

                  <p>Perform a more strict comparison of two entities. To
                  return true, the entity and the object passed must meet the
                  following criteria:</p><table border="0" summary="Simple list" class="simplelist"><tr><td>They must be entities.</td></tr><tr><td>They must have equal GUIDs. (Or both can have no
                      GUID.)</td></tr><tr><td>They must be instances of the same
                      class.</td></tr><tr><td>Their data must be equal.</td></tr></table>
                </li><li class="listitem">
                  <p><code class="methodname">in_array</code></p>

                  <p>Check whether the entity is in an array. Takes two
                  arguments, the array and a boolean
                  <code class="varname">$strict</code>. If <code class="varname">$strict</code> is
                  false, the function uses <code class="methodname">is</code> to
                  compare, and if it's true, the function uses
                  <code class="methodname">equals</code>.</p>
                </li><li class="listitem">
                  <p><code class="methodname">array_search</code></p>

                  <p>Search an array for the entity and return the
                  corresponding key. Takes two arguments, the array and a
                  boolean <code class="varname">$strict</code>. If
                  <code class="varname">$strict</code> is false, the function uses
                  <code class="methodname">is</code> to compare, and if it's true,
                  the function uses <code class="methodname">equals</code>. This
                  method may return 0, which evaluates to false, so you should
                  use <code class="methodname">in_array</code> if you are only
                  checking whether the entity is in the array.</p>
                </li></ul></div><div class="informalexample">
                <h5><a id="idp830240"></a>Comparing Entities</h5>

                <pre class="programlisting">$entity = entity::factory();

$entity-&gt;is($entity); // True


$array = array('foo' =&gt; null, 'bar' =&gt; $entity);

echo $entity-&gt;array_search($array); // Outputs 'bar'</pre>
              </div>

            <p>The entity manager provides three methods to sort entities.
            Each one uses a different method of sorting.</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">hsort</code></p>

                  <p>Sort an array of entities hierarchically by a
                  specified property's value.</p>
                </li><li class="listitem">
                  <p><code class="methodname">psort</code></p>

                  <p>Sort an array of entities by parent and a specified
                  property's value. If they have the same parent, their own
                  value is used.</p>
                </li><li class="listitem">
                  <p><code class="methodname">sort</code></p>

                  <p>Sort an array of entities by a specified property's
                  value.</p>
                </li></ul></div><div class="informalexample">
                <h5><a id="idp837904"></a>Sorting Entities</h5>

                <pre class="programlisting">$cats = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_category),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'category')
        )
    );

$case_sensitive = false;
$reverse = false;

// Sort categories hierarchically by their name.
$pines-&gt;entity_manager-&gt;hsort($cats, 'name', 'parent', $case_sensitive, $reverse);

// Sort categories by their parent's name.
$pines-&gt;entity_manager-&gt;psort($cats, 'name', 'parent', $case_sensitive, $reverse);

// Sort categories by their name.
$pines-&gt;entity_manager-&gt;sort($cats, 'name', $case_sensitive, $reverse);</pre>
              </div>
          </div>

          <div class="section" title="4.1.3.4. Entity Querying"><div class="titlepage"><div><div><h4 class="title"><a id="idp839824"></a>4.1.3.4. Entity Querying</h4></div></div></div>
            

            <p>The real power behind the entity manager is the entity
            querying system. After all, what's the use of having complex data
            and relationships if you can't find it?</p>

            <p>The simplest way to get an entity is usually its
            <code class="methodname">factory</code> static method. Almost all
            entities provided by SciActive maintained components use a
            <code class="methodname">factory</code> that takes a GUID as an argument.
            However, the author of an entity's class can use whatever they
            like as arguments. For example, the <code class="classname">user</code>
            class takes either a GUID or a username. Usually the method will
            return a brand new entity if the queried entity is not found.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tip.png" /></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
                <p>If you're using a user provided value as the GUID,
                casting it to an int will ensure it is evaluated as a GUID.
                Also, non-numeric values will be evaluated as 0, resulting in
                a new entity, since no entity has GUID 0. Then you can
                determine if it was found by checking that
                <code class="varname">guid</code> is set.</p>
              </td></tr></table></div><div class="informalexample">
                <h5><a id="idp845280"></a>Getting Entities Using the Factory
                Method</h5>

                <pre class="programlisting">// Most entities use a GUID.
$baz = com_foobar_baz::factory((int) $_REQUEST['id']);

if (!isset($baz-&gt;guid)) {
    pines_notice('The specified baz cannot be found!');
    return;
}

// When selecting a user, you can use a GUID or a username.
$cron_user = user::factory('cron');

if (!isset($cron_user-&gt;guid)) {
    pines_notice('Can\'t find the cron user! Have you created one yet?');
    return;
}

// If the script made it to this point, both $baz and $cron_user were found!
pines_notice('Hooray! I found the baz you wanted and the cron user!');</pre>
              </div>

            <p>The really powerful way of querying entities is the entity
            manager's <code class="methodname">get_entities</code> and
            <code class="methodname">get_entity</code> methods.</p>

            <p>The first argument to these functions is an options array.
            It is an associative array of key value pairs signifying options.
            The options array can be empty, in which case the
            <code class="classname">entity</code> class will be used for returned
            entities. The following is a list of options which all entity
            managers support.</p><div class="table"><a id="idp849808"></a><p class="title"><strong>Table 4.1. Entity Querying Options</strong></p><div class="table-contents">
                

                <table summary="Entity Querying Options" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>class</td><td>string</td><td>"entity"</td><td>The class used to create each entity. It must
                      have a <code class="methodname">factory</code> static method
                      that returns a new instance.</td></tr><tr><td>limit</td><td>int</td><td>null</td><td>The limit of entities to be returned. Not needed
                      when using <code class="methodname">get_entity</code>, as it
                      always returns only one.</td></tr><tr><td>offset</td><td>int</td><td>0</td><td>The offset from the oldest (or newest if
                      reversed) matching entity to start retrieving.</td></tr><tr><td>reverse</td><td>bool</td><td>false</td><td>If true, entities will be retrieved from newest
                      to oldest. Therefore, offset will be from the newest
                      entity.</td></tr><tr><td>sort</td><td>string</td><td>"guid"</td><td>How to sort the entities. Accepts "guid",
                      "cdate", and "mdate".</td></tr><tr><td>skip_ac</td><td>bool</td><td>false</td><td>If true, the user manager will not filter
                      returned entities according to access controls.</td></tr></tbody></table>
              </div></div><p><br class="table-break" /></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
                <p>When using skip_ac, any referenced entities, when
                accessed, will also be retrieved using skip_ac.</p>
              </td></tr></table></div>

            <p>A component or entity manager implementation is free to add
            extra options, but it should consider prepending the component's
            name to the name of the option. For example, if your component,
            com_entityversions, wants to add the option "date", it should use
            "com_entityversions_date".</p>

            <p>Every argument following the options array is a selector. A
            selector is an associative array of criteria. An entity must pass
            each selector's criteria to be returned. The first member of the
            array (the value at index 0) is the type of selector, which
            determines how the criteria are matched against an entity's
            data.</p><div class="table"><a id="idp845904"></a><p class="title"><strong>Table 4.2. Entity Selector Types</strong></p><div class="table-contents">
                

                <table summary="Entity Selector Types" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>&amp;</td><td>And</td><td>All values in the selector must be true.</td></tr><tr><td>|</td><td>Or</td><td>At least one value in the selector must be
                      true.</td></tr><tr><td>!&amp;</td><td>Not And</td><td>All values in the selector must be false.</td></tr><tr><td>!|</td><td>Not Or</td><td>At least one value in the selector must be
                      false.</td></tr></tbody></table>
              </div></div><p><br class="table-break" /></p>

            <p>The following members of the array are the criteria of the
            selector. They must be in the form <code class="code">$selector['name'] =
            $value</code>, or <code class="code">$selector['name'] = array($value1,
            $value2,...)</code>. They can be negated by prepending a bang (!)
            to the name, such as <code class="code">$selector['!tag'] =
            'user'</code>.</p><div class="table"><a id="idp886240"></a><p class="title"><strong>Table 4.3. Entity Selector Criteria</strong></p><div class="table-contents">
                

                <table summary="Entity Selector Criteria" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>Name</th><th>Value</th><th>Condition</th><th>Example Selector</th><th>Matching Entity</th></tr></thead><tbody><tr><td>guid</td><td>A GUID.</td><td>True if the entity's GUID is equal.</td><td><code class="code">array('&amp;', 'guid' =&gt;
                      12)</code></td><td><code class="code">$entity-&gt;guid =
                      12;</code></td></tr><tr><td>tag</td><td>A tag.</td><td>True if the entity has the tag.</td><td><code class="code">array('&amp;', 'tag' =&gt;
                      'com_foobar')</code></td><td><code class="code">$entity-&gt;add_tag('com_foobar');</code></td></tr><tr><td>isset</td><td>A name.</td><td>True if the named variable exists and is not
                      null.</td><td><code class="code">array('&amp;', 'isset' =&gt;
                      'foo')</code></td><td><code class="code">$entity-&gt;foo =
                      0;</code></td></tr><tr><td>data</td><td>An array with a name, then value.</td><td>True if the named variable is defined and
                      equal.</td><td><code class="code">array('&amp;', 'data' =&gt; array('foo',
                      false))</code></td><td><code class="code">$entity-&gt;foo =
                      0;</code></td></tr><tr><td>strict</td><td>An array with a name, then value.</td><td>True if the named variable is defined and
                      identical.</td><td><code class="code">array('&amp;', 'strict' =&gt; array('foo',
                      0))</code></td><td><code class="code">$entity-&gt;foo =
                      0;</code></td></tr><tr><td>array</td><td>An array with a name, then value.</td><td>True if the named variable is an array containing
                      the value. Uses in_array().</td><td><code class="code">array('&amp;', 'array' =&gt; array('foo',
                      'bar'))</code></td><td><code class="code">$entity-&gt;foo =
                      array('bar', 'baz');</code></td></tr><tr><td>match</td><td>An array with a name, then regular
                      expression.</td><td>True if the named variable matches. Uses
                      preg_match().</td><td><code class="code">array('&amp;', 'match' =&gt; array('foo',
                      '/bar/'))</code></td><td><code class="code">$entity-&gt;foo =
                      'foobarbaz';</code></td></tr><tr><td>gt</td><td>An array with a name, then value.</td><td>True if the named variable is greater than the
                      value.</td><td><code class="code">array('&amp;', 'gt' =&gt; array('foo',
                      5))</code></td><td><code class="code">$entity-&gt;foo =
                      6;</code></td></tr><tr><td>gte</td><td>An array with a name, then value.</td><td>True if the named variable is greater than or
                      equal to the value.</td><td><code class="code">array('&amp;', 'gte' =&gt; array('foo',
                      6))</code></td><td><code class="code">$entity-&gt;foo =
                      6;</code></td></tr><tr><td>lt</td><td>An array with a name, then value.</td><td>True if the named variable is less than the
                      value.</td><td><code class="code">array('&amp;', 'lt' =&gt; array('foo',
                      7))</code></td><td><code class="code">$entity-&gt;foo =
                      6;</code></td></tr><tr><td>lte</td><td>An array with a name, then value.</td><td>True if the named variable is less than or equal
                      to the value.</td><td><code class="code">array('&amp;', 'lte' =&gt; array('foo',
                      6))</code></td><td><code class="code">$entity-&gt;foo =
                      6;</code></td></tr><tr><td>ref</td><td>An array with a name, then either a entity, or a
                      GUID.</td><td>True if the named variable is the entity or an
                      array containing the entity.</td><td><code class="code">array('&amp;', 'ref' =&gt; array('foo',
                      12))</code></td><td><code class="code">$entity-&gt;foo =
                      com_foobar_baz::factory(12);</code></td></tr></tbody></table>
              </div></div><p><br class="table-break" /></p>

            <p>So putting it all together, you can specify any of the
            options, and any number of selectors to find the exact entities
            you want.</p><div class="informalexample">
                <h5><a id="idp937312"></a>Getting Entities by Querying</h5>

                <pre class="programlisting">// Get all entities using the entity class.
$entities = $pines-&gt;entity_manager-&gt;get_entities();

// Get only the first entity.
$entity = $pines-&gt;entity_manager-&gt;get_entity();

// Get the last entity.
$entity = $pines-&gt;entity_manager-&gt;get_entity(array('reverse' =&gt; true));

// Get all baz entities, using the com_foobar_baz class.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz')
        )
    );

// Get the five newest baz entities.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz, 'reverse' =&gt; true, 'limit' =&gt; 5),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz')
        )
    );

// Get baz entities with names.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz'),
            'isset' =&gt; 'name'
        )
    );

// Get baz entities without names.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz'),
            '!isset' =&gt; 'name'
        )
    );

// Get baz entities with either first names or last names.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz')
        ),
        array('|',
            'isset' =&gt; array('first_name', 'last_name')
        )
    );

// Get baz entities created since yesterday.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz'),
            'gt' =&gt; array('p_cdate', strtotime('-1 day'))
        )
    );

// Get baz entities with names, who either make not greater than 8 dollars pay or are under 22.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz'),
            'isset' =&gt; 'name'
        ),
        array('!|', // at least one must be false
            'gte' =&gt; array('age', 22),
            'gt' =&gt; array('pay', 8)
        )
    );

// Get baz entities named Clark, James, Chris, Christopher, Jake, or Jacob.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz')
        ),
        array('|',
            'strict' =&gt; array(
                array('name', 'Clark'),
                array('name', 'James')
            ),
            'match' =&gt; array(
                array('name', '/Chris(topher)?/'),
                array('name', '/Ja(ke|cob)/')
            )
        )
    );

// Get all baz entities, regardless of whether the logged in user has access to them.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz, 'skip_ac' =&gt; true),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz')
        )
    );</pre>
              </div>
          </div>

          <div class="section" title="4.1.3.5. Exporting and Importing Entities"><div class="titlepage"><div><div><h4 class="title"><a id="idp941744"></a>4.1.3.5. Exporting and Importing Entities</h4></div></div></div>
            

            <p>All entity managers provide a method for exporting and
            importing entities. This makes it very easy to backup, restore,
            duplicate, and move an entire database of entities, even with
            different database backends.</p>

            <p>The entity manager has the following methods for exporting
            and importing entities:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">export</code></p>

                  <p>Export entities to a file.</p>
                </li><li class="listitem">
                  <p><code class="methodname">export_print</code></p>

                  <p>Export entities to the client as a downloadable
                  file.</p>
                </li><li class="listitem">
                  <p><code class="methodname">import</code></p>

                  <p>Import entities from a file.</p>
                </li></ul></div><div class="informalexample">
                <h5><a id="idp949024"></a>Exporting and Importing Entities with the Entity
                Manager</h5>

                <pre class="programlisting">@set_time_limit(3600); // Make sure the script doesn't terminate before the entities are exported/imported.

// Export entities to a file.
$pines-&gt;entity_manager-&gt;export($filename);

// Export entities to the client.
$pines-&gt;entity_manager-&gt;export_print();

// Import entities from a file.
$pines-&gt;entity_manager-&gt;import($filename);</pre>
              </div>

            <p>The format of an entity export file is simple, and readable
            by all entity managers. The file extension, PEX, stands for Pines
            Entity eXchange. Here is an example of an exported entity
            file.</p><div class="informalexample">
                <h5><a id="idp951520"></a>Example Entity Export File (PEX)</h5>

                <pre class="programlisting"># Pines Entity Export
# com_pgentity version 1.0.0
# sciactive.com
#
# Generation Time: Tue, 05 Jul 2011 09:56:14 -0700
# Pines Version: 0.94.0beta

#
# UIDs
#

&lt;com_sales_sale&gt;[1]
#
# Entities
#

{1}[com_user,user,enabled]
    p_cdate="d:1309884676.464271068572998046875;"
    p_mdate="d:1309884676.464293003082275390625;"
    abilities="a:2:{i:0;s:10:\"system\/all\";i:1;s:14:\"com_user\/login\";}"
    groups="a:0:{}"
    inherit_abilities="b:1;"
    address_type="s:2:\"us\";"
    addresses="a:0:{}"
    attributes="a:0:{}"
    username="s:5:\"admin\";"
    salt="s:32:\"7d5bc9dc81c200444e53d1d10ecc420a\";"
    password="s:32:\"f066801b0b70491f397ad37b51b7e278\";"
    name_first="s:6:\"Hunter\";"
    name_middle="s:0:\"\";"
    name_last="s:6:\"Perrin\";"
    name="s:13:\"Hunter Perrin\";"
    email="s:20:\"hperrin@gmail.com\";"
    phone="s:0:\"\";"
    fax="s:0:\"\";"
    timezone="s:0:\"\";"
    address_1="s:0:\"\";"
    address_2="s:0:\"\";"
    city="s:0:\"\";"
    state="s:0:\"\";"
    zip="s:0:\"\";"
    address_international="s:0:\"\";"</pre>
              </div>
          </div>

          <div class="section" title="4.1.3.6. UIDs"><div class="titlepage"><div><div><h4 class="title"><a id="idp953760"></a>4.1.3.6. UIDs</h4></div></div></div>
            

            <p>UIDs provide an easier way for users to identify entities.
            UIDs are just sequential numbers and can be used for anything you
            like, not just entities. As opposed to a GUID, which is a unique
            ID for all entities, a UID is only unique for its own sequence.
            This allows them to stay small in a database filled with other
            entities.</p>

            <p>UIDs can be named anything. A good naming convention, in
            order to avoid conflicts, is to use your component's name, a
            slash, then a descriptive name of the sequence being identified
            for non-entity sequences, and the name of the entity's class for
            entity sequences. E.g. "com_example/widget_hits" or
            "com_hrm_employee".</p>

            <p>The entity manager has the following methods for handling
            UIDs:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">delete_uid</code></p>

                  <p>Delete a unique ID from the system.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_uid</code></p>

                  <p>Get the current value of a unique ID.</p>
                </li><li class="listitem">
                  <p><code class="methodname">new_uid</code></p>

                  <p>Increment or create a unique ID and return the new
                  value.</p>
                </li><li class="listitem">
                  <p><code class="methodname">rename_uid</code></p>

                  <p>Rename a unique ID.</p>
                </li><li class="listitem">
                  <p><code class="methodname">set_uid</code></p>

                  <p>Set the value of a unique ID.</p>
                </li></ul></div><div class="informalexample">
                <h5><a id="idp964832"></a>Using UIDs</h5>

                <pre class="programlisting">// Create a new entity.
$entity = com_foobar_baz::factory();

// Now give it a more friendly ID than GUID.
$entity-&gt;id = $pines-&gt;entity_manager-&gt;new_uid('com_foobar_baz');
$entity-&gt;save();</pre>
              </div>

            <div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="caution.png" /></td><th align="left">Caution</th></tr><tr><td align="left" valign="top">
              <p>If a UID is incremented for an entity, and the entity
              cannot be saved, there is no safe, and therefore, no recommended
              way to decrement the UID back to its previous value.</p>
            </td></tr></table></div>
          </div>
        </div>

        <div class="section" title="4.1.4. Icons"><div class="titlepage"><div><div><h3 class="title"><a id="idp967440"></a>4.1.4. Icons</h3></div></div></div>
          

          <p>The icon service provides a set of icons available to use
          through CSS classes. Pines Icons come in two sizes, 16x16 and 32x32.
          To use an icon, you add the class of the icon, such as
          <code class="classname">picon-document-edit</code>, to an HTML element. This
          will use the icon's 16x16 size. To use the 32x32 size, add another
          class, <code class="classname">picon-32</code>.</p>

          <p>The icon service has one method,
          <code class="methodname">load</code>, which loads the icon CSS. This method
          should be called from a view, to ensure it is only called when
          outputting HTML.</p><div class="informalexample">
              <h4><a id="idp971168"></a>Using the Icon Service</h4>

              <pre class="programlisting">&lt;?php
/* @var $pines pines *//* @var $this module */
defined('P_RUN') or die('Direct access prohibited');
// Load the icons CSS.
$pines-&gt;icons-&gt;load();
?&gt;
&lt;div style="float: left; width: 32px; height: 32px; margin: 1em;" class="picon-32 picon-document-sign"&gt;&lt;/div&gt;
&lt;p&gt;Your order can't be shipped until your contract is signed.&lt;/p&gt;

&lt;button type="button" class="btn"&gt;
    &lt;span class="picon-dialog-ok" style="background-repeat: no-repeat; padding-left: 18px;"&gt;&amp;nbsp;&lt;/span&gt;Go
&lt;/button&gt;</pre>
            </div>
        </div>

        <div class="section" title="4.1.5. Log Manager"><div class="titlepage"><div><div><h3 class="title"><a id="idp973168"></a>4.1.5. Log Manager</h3></div></div></div>
          

          <p>The log manager service provides an easy and simple logging
          feature for Pines. The default log manager can use the hook system
          to log all calls to an object under <code class="varname">$pines</code>. The
          log manager has no restriction on the backend it can use, so log
          managers can be made for flat files, MySQL, PostgreSQL, MSSQL,
          Oracle, etc.</p>

          <p>The log manager has one method, <code class="methodname">log</code>,
          which takes two arguments, the log entry and the level of the entry.
          The level can be one of the following, ordered in increasing
          severity.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>debug</p>

                <p>Provide information that could be useful while
                debugging.</p>
              </li><li class="listitem">
                <p>info</p>

                <p>Provide information that might be useful for a user.
                This is the default.</p>
              </li><li class="listitem">
                <p>notice</p>

                <p>Provide notice of an event or action that has occurred
                that the user may want to know.</p>
              </li><li class="listitem">
                <p>warning</p>

                <p>Warn the user of something that may be wrong or bad, but
                not necessarily an error.</p>
              </li><li class="listitem">
                <p>error</p>

                <p>Provide notice of an error that has occurred.</p>
              </li><li class="listitem">
                <p>fatal</p>

                <p>Provide notice of an error, from which the script cannot
                recover.</p>
              </li></ul></div><div class="informalexample">
              <h4><a id="idp985504"></a>Making an Entry in the Log</h4>

              <pre class="programlisting">$user = user::factory();
$user-&gt;username = 'bob';
$user-&gt;password('changeme');

$pines-&gt;log_manager-&gt;log('Trying to save a new user.'); // The log level defaults to info.
if ($user-&gt;save())
    $pines-&gt;log_manager-&gt;log("Saved user {$user-&gt;username}.", 'notice');
else
    $pines-&gt;log_manager-&gt;log("Couldn't save user {$user-&gt;username}.", 'error');</pre>
            </div>
        </div>

        <div class="section" title="4.1.6. Template"><div class="titlepage"><div><div><h3 class="title"><a id="template_service"></a>4.1.6. Template</h3></div></div></div>
          

          <p>The template service is a special service, which does not have
          to declare itself as the template service. Instead, Pines reads the
          configuration and determines the template. The template builds the
          layout and design of the page and inserts the content from any
          modules attached to the page. It also has the responsibility of
          building the output of the menus. Templates will be discussed in
          much greater depth in <a class="link" href="templates.html" title="Chapter 7. Templates">Templates</a> in
          <a class="link" href="pt02.html#part_2">Part II</a>.</p>

          <p>The template only needs two methods.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="methodname">menu</code></p>

                <p>Formats a menu so it can be printed into content.</p>
              </li><li class="listitem">
                <p><code class="methodname">url</code></p>

                <p>Creates a URL, utilizing the Pines URL rewriting setup.
                Has the following arguments:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                      <p>The name of the component to be requested by the
                      URL.</p>
                    </li><li class="listitem">
                      <p>The name of the action to be requested by the
                      URL.</p>
                    </li><li class="listitem">
                      <p>An associative array of parameters to be used as
                      query data in the URL.</p>
                    </li><li class="listitem">
                      <p>Boolean determining if the URL should be a full
                      URL. Otherwise, it will be a URL relative to the server
                      of the Pines installation.</p>
                    </li></ol></div>
              </li></ul></div><div class="informalexample">
              <h4><a id="idp999728"></a>Formatting a URL Using the Template
              Service</h4>

              <pre class="programlisting">// A URL suitable for a link on a page in Pines.
$link = $pines-&gt;template-&gt;url('com_example', 'widget/edit', array('id' =&gt; $widget-&gt;guid));
// or you can use the shortcut function:
$link = pines_url('com_example', 'widget/edit', array('id' =&gt; $widget-&gt;guid));

// A URL suitable for a link in an external page or an email.
$link = $pines-&gt;template-&gt;url('com_example', 'widget/edit', array('id' =&gt; $widget-&gt;guid), true);

// The URL of the home page of the Pines installation.
$link = pines_url();</pre>
            </div>

          <p>Templates also have some properties which define how output is
          constructed/viewed.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="varname">editor_css</code></p>

                <p>The location of a stylesheet to be used by WYSIWYG
                editors.</p>
              </li><li class="listitem">
                <p><code class="varname">format</code></p>

                <p>The format of the template. This format is used by Pines
                to find the view when a module is being rendered.</p>
              </li></ul></div>

          <p>The template format uses dashes to separate its parts, and
          describes the language, format, version, etc. of the view. The
          following are some example formats and a description of their
          language and what they're for.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>html-desktop-5</p>

                <p>HTML 5 for desktops.</p>
              </li><li class="listitem">
                <p>html-mobile-4-01</p>

                <p>HTML 4.01 for mobile screens.</p>
              </li><li class="listitem">
                <p>html-desktop-xhtml-1-0-strict</p>

                <p>XHTML 1.0 Strict for desktops.</p>
              </li><li class="listitem">
                <p>xml-rss-2-0</p>

                <p>RSS 2.0.</p>
              </li></ul></div>

          <p>For more information on templates, you can see <a class="link" href="templates.html" title="Chapter 7. Templates">Templates</a> in Part II.</p>
        </div>

        <div class="section" title="4.1.7. Uploader"><div class="titlepage"><div><div><h3 class="title"><a id="idp1011776"></a>4.1.7. Uploader</h3></div></div></div>
          

          <p>The uploader service provides a convenient way for the user to
          upload and manage files on the server. The intent of the uploader
          service is to allow files to be uploaded and selected using an Ajax
          enabled interface for ease of use.</p>

          <p>Once the uploader is loaded, it will transform any text inputs
          with the class "puploader" into Ajax file uploaders/selectors. If
          you would like the user to be able to select folders, add the
          "puploader-folders" class. If you would like the user to be able to
          select multiple files, add the "puploader-multiple" class. Add the
          class "puploader-temp" to emulate a single file upload. Only one
          file will be allowed, and it will be placed into a temporary
          directory. Note that the check method is not needed when you are
          using a temp file. To use the uploader in a view, call the
          <code class="methodname">load</code> method. This method should be called
          from a view, to ensure it is only called when outputting
          HTML.</p><div class="informalexample">
              <h4><a id="idp1014976"></a>Using the Uploader Service in a View</h4>

              <pre class="programlisting">&lt;?php
/**
 * Prints an uploader.
 *
 * @license http://www.gnu.org/licenses/agpl-3.0.html
 * @author Hunter Perrin &lt;hperrin@gmail.com&gt;
 * @copyright SciActive.com
 * @link http://sciactive.com/
 */
/* @var $pines pines *//* @var $this module */
defined('P_RUN') or die('Direct access prohibited');
$this-&gt;title = 'Uploader';
// Load the uploader.
$pines-&gt;uploader-&gt;load();
?&gt;
&lt;div&gt;Choose or Upload a File on the Server&lt;/div&gt;
&lt;div&gt;&lt;input class="puploader" name="upload_file" type="text" value="" /&gt;&lt;/div&gt;
&lt;div&gt;Upload a New File&lt;/div&gt;
&lt;div&gt;&lt;input class="puploader puploader-temp" name="temp_file" type="text" value="" /&gt;&lt;/div&gt;</pre>
            </div>

          <p>The value of the field when the form is submitted will be the
          relative URL of the selected file. When selecting multiple files,
          they will be separated by two forward slashes "//". After receiving
          the path of the file, it should <span class="bold"><strong>always</strong></span> be checked using the
          <code class="methodname">check</code> method of the uploader service
          (unless it is a temp upload). This will verify that the user didn't
          maliciously alter the URL. It can then be translated to a real file
          path using the <code class="methodname">real</code> method, and back to a
          URL again with the <code class="methodname">url</code> method. The
          <code class="methodname">url</code> method takes an extra argument, which
          determines whether a full URL should be returned instead of a
          relative URL.</p><div class="informalexample">
              <h4><a id="idp1020880"></a>Verifying and Using a URL Returned by the
              Uploader</h4>

              <pre class="programlisting">$file_url = $_REQUEST['upload_file'];

// The first step is always checking the file URL.
if (!$pines-&gt;uploader-&gt;check($file_url)) {
    pines_notice('Invalid file path submitted!');
    return;
}

// Now get the real file path.
$file_path = $pines-&gt;uploader-&gt;real($file_url);

// And the full URL of the file.
$file_url_full = $pines-&gt;uploader-&gt;url($file_path, true);</pre>
            </div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="warning.png" /></td><th align="left">Warning</th></tr><tr><td align="left" valign="top">
              <p>Using a submitted URL without first checking it could
              allow a user to bypass safety features and exploit a server,
              potentially giving them access to confidential
              information.</p>
            </td></tr></table></div>

          <p>When you accept a temp upload, use the
          <code class="methodname">temp</code> method to get the real file path to
          the uploaded file.</p><div class="informalexample">
              <h4><a id="idp1024592"></a>Using a Temp File Returned by the
              Uploader</h4>

              <pre class="programlisting">$file = $_REQUEST['temp_file'];

// Get the path to the temporary location of the file.
$file_path = $pines-&gt;uploader-&gt;temp($file);
if (!$file_path) {
    pines_notice('Invalid file path submitted!');
    return;
}

// Now you can move the file into a permanent location with rename().</pre>
            </div>
        </div>

        <div class="section" title="4.1.8. User Manager"><div class="titlepage"><div><div><h3 class="title"><a id="idp1026368"></a>4.1.8. User Manager</h3></div></div></div>
          

          <p>The user manager service is one of Pines' most powerful
          features. It has many features and responsibilities, designed to
          separate and protect data. Fully understanding the user manager will
          allow you to create complex systems which function safely in a
          multi-user environment.</p>

          <p>The user manager has several methods to help access and
          organize user and group data.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="methodname">fill_session</code></p>

                <p>Fill the <code class="varname">$_SESSION['user']</code> variable
                with the logged in user's data. It also sets the default
                timezone used by date functions to the user's timezone.</p>
              </li><li class="listitem">
                <p><code class="methodname">get_groups</code></p>

                <p>Get the system's groups. It takes one argument, which,
                when true, will cause it to return both disabled and enabled
                groups, rather than just enabled groups.</p>
              </li><li class="listitem">
                <p><code class="methodname">get_users</code></p>

                <p>Get the system's users. It takes one argument, which,
                when true, will cause it to return both disabled and enabled
                users, rather than just enabled users.</p>
              </li><li class="listitem">
                <p><code class="methodname">group_sort</code></p>

                <p>Sort an array of groups hierarchically. An additional
                property of the groups can be used to sort them under their
                parents. It takes up to four arguments:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                      <p>The array of groups.</p>
                    </li><li class="listitem">
                      <p>The name of the property to sort groups by. Null
                      for no additional sorting.</p>
                    </li><li class="listitem">
                      <p>Boolean, determines whether to sort case
                      sensitively.</p>
                    </li><li class="listitem">
                      <p>Boolean, determines whether to reverse the sort
                      order.</p>
                    </li></ol></div>
              </li><li class="listitem">
                <p><code class="methodname">login</code></p>

                <p>Logs the given user into the system. Takes only one
                argument, the user.</p>
              </li><li class="listitem">
                <p><code class="methodname">logout</code></p>

                <p>Logs the current user out of the system.</p>
              </li><li class="listitem">
                <p><code class="methodname">print_login</code></p>

                <p>Creates and attaches a module which lets the user log
                in. Takes up to two arguments, the position of the new module,
                and a URL to which the user will be redirected after logging
                in.</p>
              </li><li class="listitem">
                <p><code class="methodname">punt_user</code></p>

                <p>Kick the user out of the current page. This method
                completely terminates execution of the script when it is
                called. Code after this method is called will not run. Though
                not required, user managers will usually give the user an
                opportunity to log in and return to the page, if they are not
                currently logged in. This method takes up to two arguments, a
                message to display to the user, and the URL they should use to
                retry after logging in. If no message is given, a generic
                message will be displayed. To prevent a message, use an empty
                string.</p>
              </li></ul></div>

          <p>Two of the methods of the user manager,
          <code class="methodname">gatekeeper</code> and
          <code class="methodname">punt_user</code>, have shortcut functions to make
          calling them easier. Unlike most shortcut functions in Pines, which
          have "pines_" prepended to their names, these two functions have
          identical names as their method counterparts.</p>

          <p>Access control is one of the features heavily considered since
          the beginning of Pines' development. As such, the user manager has
          some unique and powerful systems of access control.</p>

          <div class="section" title="4.1.8.1. Access Control Systems"><div class="titlepage"><div><div><h4 class="title"><a id="idp1048960"></a>4.1.8.1. Access Control Systems</h4></div></div></div>
            

            <p>This section discusses the different types of access control
            that the user manager service provides. A component is not
            required to utilize these systems, but they will certainly make
            designing a safe, functional, multi-user component much easier.
            When developing Pines, SciActive always considers good access
            control very important. If you plan on contributing code to
            SciActive maintained components or Pines Core, please take the
            time to learn and understand these access control systems very
            well.</p>

            <div class="section" title="4.1.8.1.1. Abilities"><div class="titlepage"><div><div><h5 class="title"><a id="idp1050080"></a>4.1.8.1.1. Abilities</h5></div></div></div>
              

              <p>Abilities define what a user is allowed to do. Abilities
              can be given to both users and groups. When a user is in a group
              or groups that have abilities and the user is set to inherit
              abilities, the user manager will act as though the user has the
              sum of his own abilities and the abilities of all his
              groups.</p>

              <p>The user manager has to be told what abilities a component
              checks for. This is done in the component's
              <code class="filename">info.php</code> file. The info array has an entry
              called "abilities", which is an array of arrays. Each array in
              the abilities array contains three values, the name of the
              ability, the title or common name, and the description of the
              ability.</p><div class="informalexample">
                  <h6><a id="idp1054016"></a>Example Abilities Entry From an Info
                  File</h6>

                  <pre class="programlisting">'abilities' =&gt; array(
    array('view', 'View Log', 'Let the user view the Pines log.'),
    array('clear', 'Clear Log', 'Let the user clear (delete) the pines log.')
),</pre>
                </div>

              <p>Once a user has been granted abilities, the
              <code class="methodname">gatekeeper</code> method can be used to check
              them. To check an ability, append a slash and the name of the
              ability to the name of the component, and call
              <code class="methodname">gatekeeper</code>. If no user is given as the
              second argument, the currently logged in user will be used.
              There is one special ability called "system/all" which has the
              effect of granting the user all abilities.</p><div class="informalexample">
                  <h6><a id="idp1054736"></a>Checking Users' Abilities and Using
                  <code class="methodname">punt_user</code></h6>

                  <pre class="programlisting">$user = user::factory('hunter');
// Check that the user has the ability.
if (!$pines-&gt;user_manager-&gt;gatekeeper('com_logger/view', $user)) {
    pines_notice('Hunter can\'t view the Pines log.');
    return;
}

// Use shortcuts and check the current user. Punt them if they don't have the ability.
if (!gatekeeper('com_logger/view'))
    punt_user(null, pines_url('com_logger', 'view'));

// Checking two abilities. Custom punt user message.
if (!gatekeeper('com_example/viewwidgets') &amp;&amp; !gatekeeper('com_example/viewownwidgets'))
    punt_user('You need the ability to see widgets to access this page.');

// Use depend to check multiple abilities. Same as above.
if (!pines_depend('ability', 'com_example/viewwidgets|com_example/viewownwidgets'))
    punt_user('You need the ability to see widgets to access this page.');</pre>
                </div>
            </div>

            <div class="section" title="4.1.8.1.2. Entity Access Controls"><div class="titlepage"><div><div><h5 class="title"><a id="idp1060096"></a>4.1.8.1.2. Entity Access Controls</h5></div></div></div>
              

              <p>Entity access controls determine what a user can do, if
              anything, with an entity. When a component retrieves entities
              from the entity manager, the user manager filters out any
              entities the user does not have read access to before the
              entities are returned from the method. Likewise, when a
              component tries to save or delete an entity, the user manager
              will only allow it if the user has appropriate
              permission.</p>

              <p>Every entity which is created while a user is logged in
              will be owned by that user, and belong to that user's primary
              group. If an entity should belong to another user, it must be
              saved, assigned to the other user, then resaved. An entity
              belongs to a user when the user is placed in the entity's
              <code class="varname">user</code> variable. Likewise, an entity belongs to
              a group when the group is placed in the entity's
              <code class="varname">group</code> variable.</p>

              <p>Access controls are stored in a variable called
              <code class="varname">ac</code> on every entity. This variable is an
              object with the following three variables.</p><div class="table"><a id="idp1064528"></a><p class="title"><strong>Table 4.4. Entity Access Control Variables</strong></p><div class="table-contents">
                  

                  <table summary="Entity Access Control Variables" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Value</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td><code class="varname">user</code></td><td>3</td><td>Controls the entity's owner's access.</td></tr><tr><td><code class="varname">group</code></td><td>3</td><td>Controls the access of all users in both the
                        entity's group and all ancestor groups.</td></tr><tr><td><code class="varname">other</code></td><td>0</td><td>Controls all other users' access.</td></tr></tbody></table>
                </div></div><p><br class="table-break" /></p>

              <p>Each of these three variables can be one of the following
              numeric values.</p><div class="table"><a id="idp1076224"></a><p class="title"><strong>Table 4.5. Entity Access Control Values</strong></p><div class="table-contents">
                  

                  <table summary="Entity Access Control Values" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Value</th><th>Access Level</th></tr></thead><tbody><tr><td>0</td><td>No access to the entity is granted.</td></tr><tr><td>1</td><td>Access is granted to read the entity.</td></tr><tr><td>2</td><td>Access is granted to read and edit the
                        entity.</td></tr><tr><td>3</td><td>Access is granted to read, edit, and delete the
                        entity.</td></tr></tbody></table>
                </div></div><p><br class="table-break" /></p><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="caution.png" /></td><th align="left">Caution</th></tr><tr><td align="left" valign="top">
                  <p>If your component allows the user to edit an entity's
                  <code class="varname">user</code>, <code class="varname">group</code>, or
                  <code class="varname">ac</code> variable, the access control mechanism
                  could probably be easily circumvented.</p>
                </td></tr></table></div>

              <p>The user manager's
              <code class="methodname">check_permissions</code> method can be used to
              determine whether the current user has certain access to an
              entity. It takes two arguments, the entity and the type of
              access to check. The type of access is given as an integer, and
              returns true if the user has at least that level of access.
              Different situations use different checks to determine the
              user's access.</p><div class="table"><a id="idp1089984"></a><p class="title"><strong>Table 4.6. Entity Access Checking Situations</strong></p><div class="table-contents">
                  

                  <table summary="Entity Access Checking Situations" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Situation</th><th>Check Performed/Value Returned</th></tr></thead><tbody><tr><td>No user is logged in.</td><td>Always true, should be managed with
                        abilities.</td></tr><tr><td>The entity has no user and no group.</td><td>Always true.</td></tr><tr><td>The user has the "system/all" ability.</td><td>Always true.</td></tr><tr><td>The entity is the user.</td><td>Always true.</td></tr><tr><td>The entity is the user's primary group.</td><td>Always true.</td></tr><tr><td>The entity is a user or group.</td><td>Always true.</td></tr><tr><td>Its <code class="varname">user</code> variable is the
                        user. (It is owned by the user.)</td><td>Check user AC.</td></tr><tr><td>Its <code class="varname">group</code> variable is the
                        user's primary group.</td><td>Check group AC.</td></tr><tr><td>Its <code class="varname">group</code> variable is one of
                        the user's secondary groups.</td><td>Check group AC.</td></tr><tr><td>Its <code class="varname">group</code> variable is a
                        descendant of one of the user's groups.</td><td>Check group AC.</td></tr><tr><td>None of the above.</td><td>Check other AC.</td></tr></tbody></table>
                </div></div><p><br class="table-break" /></p>

              <p>A component can change the access control variable to
              allow or prevent access.</p><div class="informalexample">
                  <h6><a id="idp1112032"></a>Changing the Access Controls of an
                  Entity</h6>

                  <pre class="programlisting">// Create a new baz entity.
$entity = com_foobar_baz::factory();
$entity-&gt;foo = 'bar';

// Allow all users to see it, but only the current user to edit or delete it.
$entity-&gt;ac = (object) array(
    'user' =&gt; 3,
    'group' =&gt; 1,
    'other' =&gt; 1
);

$entity-&gt;save();</pre>
                </div>

              <p>It is the responsibility of the user manager to prevent
              your component from accessing an entity in a way the user is not
              permitted. Therefore, you don't need to add anything to your
              code. Entities that the current user does not have proper access
              to won't be returned when you query the entity manager. When you
              try to access a referenced entity, and the user manager blocks
              it due to access controls, it will appear as if the variable is
              null. If you wish to bypass the entity access control feature,
              you can use the "skip_ac" option in your entity
              queries.</p><div class="informalexample">
                  <h6><a id="idp1115136"></a>Using "skip_ac" to Access Entities</h6>

                  <pre class="programlisting">// Get all baz entities, regardless of whether the logged in user has access to them.
$entities = $pines-&gt;entity_manager-&gt;get_entities(
        array('class' =&gt; com_foobar_baz, 'skip_ac' =&gt; true),
        array('&amp;',
            'tag' =&gt; array('com_foobar', 'baz')
        )
    );</pre>
                </div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
                  <p>When you request entities using the "skip_ac" option,
                  any referenced entities will also be retrieved using the
                  "skip_ac" option.</p>
                </td></tr></table></div>
            </div>
          </div>

          <div class="section" title="4.1.8.2. User"><div class="titlepage"><div><div><h4 class="title"><a id="idp1117824"></a>4.1.8.2. User</h4></div></div></div>
            

            <p>The user class is very similar to the entity class. Their
            interfaces both extend
            <code class="interfacename">DataObjectInterface</code>, so they
            share many of the same methods. Here is a list of the methods they
            share.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">array_search</code></p>
                </li><li class="listitem">
                  <p><code class="methodname">delete</code></p>
                </li><li class="listitem">
                  <p><code class="methodname">equals</code></p>
                </li><li class="listitem">
                  <p><code class="methodname">in_array</code></p>
                </li><li class="listitem">
                  <p><code class="methodname">is</code></p>
                </li><li class="listitem">
                  <p><code class="methodname">refresh</code></p>
                </li><li class="listitem">
                  <p><code class="methodname">save</code></p>
                </li></ul></div>

            <p>Although the user's information doesn't have to be stored in
            an entity, users must act like entities in the following
            ways.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p>Users must have unique GUIDs, just like
                  entities.</p>
                </li><li class="listitem">
                  <p>The user class must provide a
                  <code class="methodname">factory</code> method.</p>
                </li><li class="listitem">
                  <p>When requesting entities, users must be returned if
                  they match as well.</p>
                </li><li class="listitem">
                  <p>Users must be able to store data, including entity
                  references, just like entities.</p>
                </li><li class="listitem">
                  <p>Users must work with the "ref" selector in the entity
                  manager.</p>
                </li></ul></div>

            <p>What this means is that even though users are not
            necessarily entities, they can be treated as if they were, except
            for tags. It is up to the user manager implementation whether to
            use entities to store users. The SciActive maintained user manager
            uses entities to handle users and groups.</p>

            <p>Users have several useful methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">add_group</code></p>

                  <p>Add the user to a (secondary) group. Takes one
                  argument, the group. Returns true if the user is already in
                  the group, the resulting array of groups if the user was
                  not.</p>
                </li><li class="listitem">
                  <p><code class="methodname">check_password</code></p>

                  <p>Check the given password against the user's. Takes one
                  argument, the password in question. Returns true if the
                  passwords match, otherwise false.</p>
                </li><li class="listitem">
                  <p><code class="methodname">del_group</code></p>

                  <p>Remove the user from a (secondary) group. Takes one
                  argument, the group. Returns true if the user wasn't in the
                  group, the resulting array of groups if the user was.</p>
                </li><li class="listitem">
                  <p><code class="methodname">disable</code></p>

                  <p>Disable the user.</p>
                </li><li class="listitem">
                  <p><code class="methodname">enable</code></p>

                  <p>Enable the user.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_timezone</code></p>

                  <p>Returns the user's timezone. Takes a boolean argument
                  (defaults to false), whether to return an object of the
                  DateTimeZone class, instead of an identifier string.</p>
                </li><li class="listitem">
                  <p><code class="methodname">in_group</code></p>

                  <p>Check whether the user is in a (primary or secondary)
                  group. Takes one argument, the group or the group's
                  GUID.</p>
                </li><li class="listitem">
                  <p><code class="methodname">is_descendant</code></p>

                  <p>Check whether the user is in a (primary or secondary)
                  group that is a descendant of the provided group. Takes one
                  argument, the group or the group's GUID.</p>
                </li><li class="listitem">
                  <p><code class="methodname">password</code></p>

                  <p>Change the user's password. Takes one argument, the
                  new password.</p>
                </li><li class="listitem">
                  <p><code class="methodname">print_form</code></p>

                  <p>Print a form to edit the user. Returns the form's
                  module.</p>
                </li></ul></div>
          </div>

          <div class="section" title="4.1.8.3. Group"><div class="titlepage"><div><div><h4 class="title"><a id="idp1134944"></a>4.1.8.3. Group</h4></div></div></div>
            

            <p>The group class is also very similar to the entity class.
            Its interface also extends
            <code class="interfacename">DataObjectInterface</code>. It shares
            the same methods with entities that the
            <code class="classname">user</code> class shares. It also must act like
            entities in the same way users do. Again, this does not include
            support of tags.</p>

            <p>Groups are hierarchical, and all children of a group have
            the group in their <code class="varname">parent</code> variable. This makes
            traversal up the hierarchy very easy. However, traversal down the
            hierarchy is not as easy. It requires the use of the
            <code class="methodname">get_children</code> or
            <code class="methodname">get_descendants</code> methods.</p>

            <p>Groups can also have a logo. This allows an easy visual
            representation of a user's position in the group hierarchy. This
            feature is especially useful for systems which use sports teams,
            subsidiary companies, store locations, countries, guilds, etc. If
            the current group doesn't have an associated logo, the user
            manager should traverse up the hierarchy until it finds a group
            with a logo, or return the default logo if it can't find
            one.</p>

            <p>Groups have several useful methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                  <p><code class="methodname">disable</code></p>

                  <p>Disable the group.</p>
                </li><li class="listitem">
                  <p><code class="methodname">enable</code></p>

                  <p>Enable the group.</p>
                </li><li class="listitem">
                  <p><code class="methodname">is_descendant</code></p>

                  <p>Check whether the group is a descendant of the
                  provided group. Takes one argument, the group or the group's
                  GUID.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_children</code></p>

                  <p>Gets an array of the group's child groups.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_descendants</code></p>

                  <p>Gets an array of the group's descendant groups. Takes
                  a boolean argument (defaults to false), whether to include
                  itself in the returned array.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_level</code></p>

                  <p>Get the number of parents the group has. If the group
                  is a top level group, this will return 0. If it is a child
                  of a top level group, this will return 1. If it is a
                  grandchild of a top level group, this will return 2, and so
                  on.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_logo</code></p>

                  <p>Find the location of the group's current logo image.
                  Takes a boolean argument (defaults to false), whether to
                  return a full URL, instead of a relative one. Returns the
                  URL of the logo image.</p>
                </li><li class="listitem">
                  <p><code class="methodname">get_users</code></p>

                  <p>Gets an array of users in the group. Some user
                  managers may return only enabled users, so don't rely on
                  this returning all users. Takes a boolean argument (defaults
                  to false), whether to include users in all descendant groups
                  too.</p>
                </li><li class="listitem">
                  <p><code class="methodname">print_form</code></p>

                  <p>Print a form to edit the group. Returns the form's
                  module.</p>
                </li></ul></div>
          </div>
        </div>
      </div>

      
    </div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s06.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="pt01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.6. Order of Execution </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.2. Creating a Service</td></tr></table></div></body></html>
